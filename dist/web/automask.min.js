!function(){var u,t,l,e,o,r;(t=u=u||{}).MASK="mask",t.PREFIX="prefix",t.SUFFIX="suffix",t.DIRECTION="dir",t.ACCEPT="accept",t.PERSIST="persist",t.SHOW_MASK="show-mask",(e=l=l||{}).FORWARD="forward",e.BACKWARD="backward",(r=o=o||{}).UNKNOWN="unknown",r.BACKSPACE="backspace",r.INVALID="invalid",r.VALID="valid";var n,h=document;function i(t){for(var e=d.getAutoMask(t),r=e.currentValue,n=e.pattern.length,i="",a=0,s=0;s<n;s++){var u=e.pattern.charAt(s);if(f(r,a)){if(!e.showMask&&!c(e.pattern,s))break;i+=u}else i+=p(u)?r.charAt(a++):u}e.value=i}function f(t,e){return e>=t.length||e<0}function p(t){return"_"===t||"0"===t||""===t}function c(t,e){for(;!f(t,e);){var r=t.charAt(e++);if("0"===r)return!0;if("_"===r)return!1}return!1}function a(t){for(var e="",r=t.length;r;)e+=t[--r];return e}n=function(){function t(){var t=e[--r];i(t),t.addEventListener("keydown",function(){t.distance=t.value.length-t.selectionStart},!0),t.addEventListener("input",function(){i(t)},!0)}for(var e=h.querySelectorAll("[mask]"),r=e.length;r;)t()},h.addEventListener("DOMContentLoaded",n);var d=(Object.defineProperty(v.prototype,"value",{get:function(){var t=this.removePrefixAndSuffix(this.element.value);if(t.length>this.pattern.length){var e=this.dir===l.FORWARD?0:1;t=t.substr(e,this.pattern.length)}return t=this.removeZeros(t.replace(this.deny,"")),this.applyDir(t)},set:function(t){var e=this.selection;t=this.prefix+this.applyDir(t)+this.suffix,void 0!==this.persist&&(this.persist.element.value=function(t,e){var r=t.match(e);return null===r?"":r.join("")}(t,this.persist.pattern)),this.element.value=t,this.selection=this.calcNewSelection(e)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"elValue",{get:function(){return this.element.value},set:function(t){this.element.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"selection",{get:function(){return this.element.selectionStart},set:function(t){this.element.selectionStart=this.element.selectionEnd=t},enumerable:!0,configurable:!0}),v.prototype.removePrefixAndSuffix=function(t){return t=this.removePrefix(t,this.prefix),t=a(this.removePrefix(a(t),a(this.suffix)))},v.prototype.removePrefix=function(t,e){if(0===t.indexOf(e))return t.substr(e.length);for(var r,n=e.length,i=0,a=0;a<n;a++){var s=e.charAt(a);if(s!==(r=t.charAt(a))){i=s===t.charAt(a+1)?1:-1;break}}var u=1===i?1:0,l=a+u;return-1!==l&&l===t.indexOf(e.substr(a+1-u),l)?(1===i?r:"")+t.substr(e.length+i):t},v.prototype.applyDir=function(t){return this.dir!==l.BACKWARD?t:a(t)},v.prototype.removeZeros=function(t){return this.zeroPadEnabled?t.replace(this.dir===l.FORWARD?/0*$/:/^0*/,""):t},v.prototype.calcNewSelection=function(t){if(this.dir===l.BACKWARD)return this.elValue.length-(this.suffix.length>this.element.distance?this.suffix.length:this.element.distance);var e,r=t-this.prefix.length;for(r<0&&(r=this.keyType===o.VALID?1:0),e=this.keyType===o.INVALID?-1:this.keyType===o.BACKSPACE?-1:1;!p(this.pattern.charAt(r-1));)r+=e;return this.getMaxSelection(r)+this.prefix.length},v.prototype.getMaxSelection=function(t){var e=this.pattern.length,r=this.value.length;if(0===t||0===r)return 0;for(var n=1;n<e;n++)if(p(this.pattern.charAt(n-1))&&(0==--r||t===n))return n;return e},v.prototype.attr=function(t,e){return this.element.getAttribute(t)||e},v.prototype.updateValue=function(){this.lastValue=this.currentValue,this.currentValue=this.value,this.currentValue.length===this.lastValue.length+1?this.keyType=this.deny.test(this.elValue.charAt(this.selection-1))?o.INVALID:o.VALID:this.currentValue.length===this.lastValue.length-1?this.keyType=o.BACKSPACE:this.keyType=o.UNKNOWN,console.log(this.keyType)},v.getAutoMask=function(t){return void 0===t.autoMask?t.autoMask=v.byElement(t):(t.autoMask.updateValue(),t.autoMask)},v.byElement=function(t){var e=new v;e.element=t,e.dir=e.attr(u.DIRECTION,l.FORWARD),e.prefix=e.attr(u.PREFIX,""),e.suffix=e.attr(u.SUFFIX,""),e.pattern=e.applyDir(e.attr(u.MASK)),e.showMask="true"===e.attr(u.SHOW_MASK,"").toLowerCase()||!1,e.deny=new RegExp("[^"+e.attr(u.ACCEPT,"\\d")+"]+","g"),e.zeroPadEnabled=-1!==e.pattern.indexOf("0"),e.keyType=o.UNKNOWN;var r=e.attr(u.PERSIST),n=t.getAttribute("name");if(r&&n){var i=h.createElement("input");t.setAttribute("name","mask-"+n),i.setAttribute("type","hidden"),i.setAttribute("name",n),t.parentNode.appendChild(i),e.persist={element:i,pattern:new RegExp("["+r+"]+","g")}}for(var a=e.pattern.length,s=e.maxRawLength=0;s<a;s++)p(e.pattern.charAt(s))&&e.maxRawLength++;return t.maxLength=e.pattern.length+e.prefix.length+e.suffix.length+1,e.currentValue=e.value,e},v);function v(){}}();