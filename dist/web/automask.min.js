!function(){var a,e,s,t,n,r;(e=a||(a={})).FORWARD="forward",e.BACKWARD="backward",(t=s||(s={})).MASK="mask",t.PREFIX="prefix",t.SUFFIX="suffix",t.DIRECTION="dir",t.ACCEPT="accept",t.SHOW_MASK="show-mask",(r=n||(n={})).CHANGE="input",r.KEYDOWN="keydown";var i,o=document;function u(e){for(var t=h.getAutoMask(e),r=t.getRawValue(),n=t.pattern.length,i="",a=0,s=0;s<n;s++){var o=t.pattern.charAt(s);if(l(r,a)){if(!t.showMask&&!f(t.pattern,s)){if(0===s)return;break}i+=o}else i+=c(o)?r.charAt(a++):o}t.value=i}function l(e,t){return t>=e.length||t<0}function c(e){return"_"===e||("0"===e||""===e)}function f(e,t){for(;!l(e,t);){var r=e.charAt(t++);if("0"===r)return!0;if("_"===r)return!1}return!1}i=function(){for(var e=o.querySelectorAll("[mask]"),t=e.length,r=function(){var s=e[--t];u(s),s.addEventListener(n.KEYDOWN,function(){var e,t,r,n,i,a;console.log("keydown",s.value,s.selectionStart),e=s,t=h.getAutoMask(e),r=e.selectionStart,n=e.selectionEnd,i=t.prefix.length,a=t.pattern.length+t.prefix.length,r<i?r=i:a<r&&(r=a),n<i?n=i:a<n&&(n=a),e.selectionStart=r,e.selectionEnd=n,console.log("onKeyDown finished!")},!0),s.addEventListener(n.CHANGE,function(){console.log("change",s.value,s.selectionStart),u(s)},!0)};t;)r()},o.addEventListener("DOMContentLoaded",i);var h=function(){function i(){}return Object.defineProperty(i.prototype,"value",{set:function(e){var t=this.selection;this.element.value=this.prefix+this.reverseIfNeeded(e)+this.suffix,this.selection=this.calcNewSelection(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selection",{get:function(){return this.element.selectionStart},set:function(e){this.element.selectionStart=this.element.selectionEnd=e},enumerable:!0,configurable:!0}),i.prototype.getRawValue=function(){var e=this.removePrefixAndSuffix(this.element.value);return e=(e=this.removeZeros(e.replace(this.deny,""))).substr(0,this.rawTotalLength),this.reverseIfNeeded(e)},i.prototype.isValidKey=function(){return void 0===this.keyPressed||"backspace"===this.keyPressed||!this.deny.test(this.keyPressed)},i.prototype.removePrefixAndSuffix=function(e){return e.replace(new RegExp("^"+this.prefix+"|"+this.suffix+"$","g"),"")},i.prototype.reverseIfNeeded=function(e){if(this.dir!==a.BACKWARD)return e;for(var t="",r=e.length;r;)t+=e[--r];return t},i.prototype.removeZeros=function(e){return this.zeroPadEnabled?e.replace(this.dir===a.FORWARD?/0*$/:/^0*/,""):e},i.prototype.calcNewSelection=function(e){if(this.dir===a.BACKWARD)return this.element.value.length-this.suffix.length;var t,r=e-this.prefix.length;for(r<1&&(r=this.keyPressed&&"backspace"!==this.keyPressed?1:0),t=this.isValidKey()?"backspace"!==this.keyPressed?1:-1:(r--,-1);!c(this.pattern.charAt(r-1));)r+=t;return this.getMaxSelection(r)+this.prefix.length},i.prototype.getMaxSelection=function(e){var t=this.pattern.length,r=this.currentRawValue.length;if(!e||!r)return 0;for(var n=1;n<t;n++)if(c(this.pattern.charAt(n-1))&&(--r<1||n===e))return n;return t},i.getAutoMask=function(e){if(!e.autoMask)return e.autoMask=i.byElement(e);var t=e.autoMask;return t.lastRawValue=t.currentRawValue,t.currentRawValue=t.getRawValue(),t.currentRawValue.length<t.lastRawValue.length?t.keyPressed="backspace":t.keyPressed=e.value.charAt(t.selection-1),t},i.byElement=function(e){var t=new i;t.dir=e.getAttribute(s.DIRECTION)||a.FORWARD,t.prefix=e.getAttribute(s.PREFIX)||"",t.suffix=e.getAttribute(s.SUFFIX)||"",t.pattern=t.reverseIfNeeded(e.getAttribute(s.MASK)),t.showMask="true"===(e.getAttribute(s.SHOW_MASK)+"").toLowerCase()||!1,t.deny=new RegExp("[^"+(e.getAttribute(s.ACCEPT)||"\\d")+"]","g"),t.element=e,t.zeroPadEnabled=-1!==t.pattern.indexOf("0");for(var r=t.pattern.length,n=t.rawTotalLength=0;n<r;n++)c(t.pattern.charAt(n))&&t.rawTotalLength++;return t.currentRawValue=t.getRawValue(),e.maxLength=t.pattern.length+t.prefix.length+t.suffix.length+1,t},i}()}();