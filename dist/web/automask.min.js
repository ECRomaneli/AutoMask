!function(){var u,e,o,t,l,r;(e=u=u||{}).MASK="mask",e.PREFIX="prefix",e.SUFFIX="suffix",e.DIRECTION="dir",e.ACCEPT="accept",e.PERSIST="persist",e.SHOW_MASK="show-mask",(t=o=o||{}).FORWARD="forward",t.BACKWARD="backward",(r=l=l||{}).UNKNOWN="unknown",r.BACKSPACE="backspace",r.INVALID="invalid",r.VALID="valid";var n,h=document;function i(e){for(var t=d.getAutoMask(e),r=t.currentValue,n=t.pattern.length,i="",a=0,s=0;s<n;s++){var u=t.pattern.charAt(s);if(f(r,a)){if(!t.showMask&&!p(t.pattern,s))break;i+=u}else i+=c(u)?r.charAt(a++):u}t.value=i}function f(e,t){return t>=e.length||t<0}function c(e){return"_"===e||"0"===e||""===e}function p(e,t){for(;!f(e,t);){var r=e.charAt(t++);if("0"===r)return!0;if("_"===r)return!1}return!1}function a(e){for(var t="",r=e.length;r;)t+=e[--r];return t}n=function(){function e(){var e=t[--r];i(e),e.addEventListener("keydown",function(){e.distance=e.value.length-e.selectionStart},!0),e.addEventListener("input",function(){i(e)},!0)}for(var t=h.querySelectorAll("[mask]"),r=t.length;r;)e()},h.addEventListener("DOMContentLoaded",n);var d=(Object.defineProperty(v.prototype,"value",{get:function(){var e=this.removePrefixAndSuffix(this.element.value);return e=this.removeZeros(e.replace(this.deny,"")),this.applyDir(e)},set:function(e){var t=this.selection;e=this.prefix+this.applyDir(e)+this.suffix,void 0!==this.persist&&(this.persist.element.value=function(e,t){var r=e.match(t);return null===r?"":r.join("")}(e,this.persist.pattern)),this.element.value=e,this.selection=this.calcNewSelection(t)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"elValue",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"selection",{get:function(){return this.element.selectionStart},set:function(e){this.element.selectionStart=this.element.selectionEnd=e},enumerable:!0,configurable:!0}),v.prototype.removePrefixAndSuffix=function(e){return e=this.removePrefix(e,this.prefix),e=a(this.removePrefix(a(e),a(this.suffix)))},v.prototype.removePrefix=function(e,t){if(0===e.indexOf(t))return e.substr(t.length);for(var r,n=t.length,i=0,a=0;a<n;a++){var s=t.charAt(a);if(s!==(r=e.charAt(a))){i=s===e.charAt(a+1)?1:-1;break}}var u=1===i?1:0,o=a+u;return-1!==o&&o===e.indexOf(t.substr(a+1-u),o)?(1===i?r:"")+e.substr(t.length+i):e},v.prototype.applyDir=function(e){return this.dir!==o.BACKWARD?e:a(e)},v.prototype.removeZeros=function(e){return this.zeroPadEnabled?e.replace(this.dir===o.FORWARD?/0*$/:/^0*/,""):e},v.prototype.calcNewSelection=function(e){if(this.dir===o.BACKWARD)return this.elValue.length-(this.suffix.length>this.element.distance?this.suffix.length:this.element.distance);var t,r=e-this.prefix.length;for(r<0&&(r=this.keyType===l.VALID?1:0),t=this.keyType===l.INVALID?-1:this.keyType===l.BACKSPACE?-1:1;!c(this.pattern.charAt(r-1));)r+=t;return this.getMaxSelection(r)+this.prefix.length},v.prototype.getMaxSelection=function(e){var t=this.pattern.length,r=this.value.length;if(0===e||0===r)return 0;for(var n=1;n<t;n++)if(c(this.pattern.charAt(n-1))&&(0==--r||e===n))return n;return t},v.prototype.attr=function(e,t){return this.element.getAttribute(e)||t},v.prototype.updateValue=function(){this.lastValue=this.currentValue,this.currentValue=this.value,this.currentValue.length===this.lastValue.length+1?this.keyType=this.deny.test(this.elValue.charAt(this.selection-1))?l.INVALID:l.VALID:this.currentValue.length===this.lastValue.length-1?this.keyType=l.BACKSPACE:this.keyType=l.UNKNOWN,console.log(this.keyType)},v.getAutoMask=function(e){return void 0===e.autoMask?e.autoMask=v.byElement(e):(e.autoMask.updateValue(),e.autoMask)},v.byElement=function(e){var t=new v;t.element=e,t.dir=t.attr(u.DIRECTION,o.FORWARD),t.prefix=t.attr(u.PREFIX,""),t.suffix=t.attr(u.SUFFIX,""),t.pattern=t.applyDir(t.attr(u.MASK)),t.showMask="true"===t.attr(u.SHOW_MASK,"").toLowerCase()||!1,t.deny=new RegExp("[^"+t.attr(u.ACCEPT,"\\d")+"]+","g"),t.zeroPadEnabled=-1!==t.pattern.indexOf("0"),t.keyType=l.UNKNOWN;var r=t.attr(u.PERSIST),n=e.getAttribute("name");if(r&&n){var i=h.createElement("input");e.setAttribute("name","mask-"+n),i.setAttribute("type","hidden"),i.setAttribute("name",n),e.parentNode.appendChild(i),t.persist={element:i,pattern:new RegExp("["+r+"]+","g")}}for(var a=t.pattern.length,s=t.maxRawLength=0;s<a;s++)c(t.pattern.charAt(s))&&t.maxRawLength++;return e.maxLength=t.pattern.length+t.prefix.length+t.suffix.length+1,t.currentValue=t.value,t},v);function v(){}}();