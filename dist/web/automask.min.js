!function(){var l,t,o,e,h,r;(t=l||(l={})).MASK="mask",t.PREFIX="prefix",t.SUFFIX="suffix",t.DIRECTION="dir",t.ACCEPT="accept",t.PERSIST="persist",t.SHOW_MASK="show-mask",(e=o||(o={})).FORWARD="forward",e.BACKWARD="backward",(r=h||(h={})).UNKNOWN="unknown",r.BACKSPACE="backspace",r.INVALID="invalid",r.VALID="valid";var n,f=document,i=/0+$/;function a(t){for(var e=v.getAutoMask(t),r=e.currentValue,n=e.pattern.length,i="",a=0,s=0;s<n;s++){var u=e.pattern.charAt(s);if(p(r,a)){if(!e.showMask&&!d(e.pattern,s))break;i+=u}else i+=c(u)?r.charAt(a++):u}e.value=i}function p(t,e){return e>=t.length||e<0}function c(t){return"_"===t||"0"===t||""===t}function d(t,e){for(;!p(t,e);){var r=t.charAt(e++);if("0"===r)return!0;if("_"===r)return!1}return!1}function s(t){for(var e="",r=t.length;r;)e+=t[--r];return e}n=function(){for(var e=f.querySelectorAll("[mask]"),r=e.length,t=function(){var t=e[--r];a(t),t.addEventListener("keydown",function(){t.distance=t.value.length-t.selectionStart},!0),t.addEventListener("input",function(){a(t)},!0)};r;)t()},f.addEventListener("DOMContentLoaded",n);var v=function(){function u(){}return Object.defineProperty(u.prototype,"value",{get:function(){var t=this.removePrefixAndSuffix(this.element.value);if(t.length>this.pattern.length){var e=this.dir===o.FORWARD?0:1;t=t.substr(e,this.pattern.length)}return this.removeZeros(this.applyDir(t.replace(this.deny,"")))},set:function(t){var e,r,n,i=this.selection;t=this.prefix+this.applyDir(t)+this.suffix,void 0!==this.persist&&(this.persist.element.value=(e=t,r=this.persist.pattern,null===(n=e.match(r))?"":n.join(""))),this.element.value=t,this.selection=this.calcNewSelection(i)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"elValue",{get:function(){return this.element.value},set:function(t){this.element.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"selection",{get:function(){return this.element.selectionStart},set:function(t){this.element.selectionStart=this.element.selectionEnd=t},enumerable:!0,configurable:!0}),u.prototype.removePrefixAndSuffix=function(t){return t=this.removePrefix(t,this.prefix),t=s(this.removePrefix(s(t),s(this.suffix)))},u.prototype.removePrefix=function(t,e){if(0===t.indexOf(e))return t.substr(e.length);for(var r,n=e.length,i=0,a=0;a<n;a++){var s=e.charAt(a);if(s!==(r=t.charAt(a))){i=s===t.charAt(a+1)?1:-1;break}}var u=1===i?1:0,l=a+u;return-1!==l&&l===t.indexOf(e.substr(a+1-u),l)?(1===i?r:"")+t.substr(e.length+i):t},u.prototype.applyDir=function(t){return this.dir!==o.BACKWARD?t:s(t)},u.prototype.removeZeros=function(t){return this.zeroPadEnabled?t.replace(i,""):t},u.prototype.calcNewSelection=function(t){if(this.dir===o.BACKWARD)return this.elValue.length-(this.suffix.length>this.element.distance?this.suffix.length:this.element.distance);var e,r=t-this.prefix.length;for(r<0&&(r=this.keyType===h.VALID?1:0),e=this.keyType===h.INVALID?-1:this.keyType===h.BACKSPACE?-1:1;!c(this.pattern.charAt(r-1));)r+=e;return this.getMaxSelection(r)+this.prefix.length},u.prototype.getMaxSelection=function(t){var e=this.pattern.length,r=this.value.length;if(0===t||0===r)return 0;for(var n=1;n<e;n++)if(c(this.pattern.charAt(n-1))&&(0==--r||t===n))return n;return e},u.prototype.attr=function(t,e){return this.element.getAttribute(t)||e},u.prototype.updateValue=function(){this.lastValue=this.currentValue,this.currentValue=this.value,this.currentValue.length===this.lastValue.length+1?this.keyType=this.deny.test(this.elValue.charAt(this.selection-1))?h.INVALID:h.VALID:this.currentValue.length===this.lastValue.length-1?this.keyType=h.BACKSPACE:this.keyType=h.UNKNOWN,console.log(this.keyType)},u.getAutoMask=function(t){return void 0===t.autoMask?t.autoMask=u.byElement(t):(t.autoMask.updateValue(),t.autoMask)},u.byElement=function(t){var e=new u;e.element=t,e.dir=e.attr(l.DIRECTION,o.FORWARD),e.prefix=e.attr(l.PREFIX,""),e.suffix=e.attr(l.SUFFIX,""),e.pattern=e.applyDir(e.attr(l.MASK)),e.showMask="true"===e.attr(l.SHOW_MASK,"").toLowerCase()||!1,e.deny=new RegExp("[^"+e.attr(l.ACCEPT,"\\d")+"]+","g"),e.zeroPadEnabled=-1!==e.pattern.indexOf("0"),e.keyType=h.UNKNOWN;var r=e.attr(l.PERSIST),n=t.getAttribute("name");if(r&&n){var i=f.createElement("input");t.setAttribute("name","mask-"+n),i.setAttribute("type","hidden"),i.setAttribute("name",n),t.parentNode.appendChild(i),e.persist={element:i,pattern:new RegExp("["+r+"]+","g")}}for(var a=e.pattern.length,s=e.maxRawLength=0;s<a;s++)c(e.pattern.charAt(s))&&e.maxRawLength++;return t.maxLength=e.pattern.length+e.prefix.length+e.suffix.length+1,e.currentValue=e.value,e},u}()}();