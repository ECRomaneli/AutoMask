!function(){var a,e,u,t,s,r;(e=a||(a={})).MASK="mask",e.PREFIX="prefix",e.SUFFIX="suffix",e.DIRECTION="dir",e.ACCEPT="accept",e.SHOW_MASK="show-mask",(t=u||(u={})).FORWARD="forward",t.BACKWARD="backward",(r=s||(s={})).UNKNOWN="unknown",r.BACKSPACE="backspace",r.INVALID="invalid",r.VALID="valid";var n,i=document;function o(e){for(var t=p.getAutoMask(e),r=t.currentValue,n=t.pattern.length,i="",a=0,u=0;u<n;u++){var s=t.pattern.charAt(u);if(l(r,a)){if(!t.showMask&&!f(t.pattern,u))break;i+=s}else i+=h(s)?r.charAt(a++):s}t.value=i}function l(e,t){return t>=e.length||t<0}function h(e){return"_"===e||"0"===e||""===e}function f(e,t){for(;!l(e,t);){var r=e.charAt(t++);if("0"===r)return!0;if("_"===r)return!1}return!1}function c(e){for(var t="",r=e.length;r;)t+=e[--r];return t}n=function(){for(var t=i.querySelectorAll("[mask]"),r=t.length,e=function(){var e=t[--r];o(e),e.addEventListener("keydown",function(){e.distance=e.value.length-e.selectionStart},!0),e.addEventListener("input",function(){o(e)},!0)};r;)e()},i.addEventListener("DOMContentLoaded",n);var p=function(){function i(){}return Object.defineProperty(i.prototype,"value",{get:function(){var e=this.removePrefixAndSuffix(this.element.value);return e=this.removeZeros(e.replace(this.deny,"")),this.applyDir(e)},set:function(e){var t=this.selection;this.element.value=this.prefix+this.applyDir(e)+this.suffix,this.selection=this.calcNewSelection(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"elValue",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selection",{get:function(){return this.element.selectionStart},set:function(e){this.element.selectionStart=this.element.selectionEnd=e},enumerable:!0,configurable:!0}),i.prototype.removePrefixAndSuffix=function(e){return e=this.removePrefix(e,this.prefix),e=c(this.removePrefix(c(e),c(this.suffix)))},i.prototype.removePrefix=function(e,t){if(0===e.indexOf(t))return e.substr(t.length);for(var r,n=t.length,i=0,a=0;a<n;a++){var u=t.charAt(a);if(u!==(r=e.charAt(a))){i=u===e.charAt(a+1)?1:-1;break}}var s=1===i?1:0,o=a+s;return-1!==o&&o===e.indexOf(t.substr(a+1-s),o)?(1===i?r:"")+e.substr(t.length+i):e},i.prototype.applyDir=function(e){return this.dir!==u.BACKWARD?e:c(e)},i.prototype.removeZeros=function(e){return this.zeroPadEnabled?e.replace(this.dir===u.FORWARD?/0*$/:/^0*/,""):e},i.prototype.calcNewSelection=function(e){if(this.dir===u.BACKWARD)return this.elValue.length-(this.suffix.length>this.element.distance?this.suffix.length:this.element.distance);var t,r=e-this.prefix.length;for(r<0&&(r=this.keyType===s.VALID?1:0),t=this.keyType===s.INVALID?-1:this.keyType===s.BACKSPACE?-1:1;!h(this.pattern.charAt(r-1));)r+=t;return this.getMaxSelection(r)+this.prefix.length},i.prototype.getMaxSelection=function(e){var t=this.pattern.length,r=this.value.length;if(0===e||0===r)return 0;for(var n=1;n<t;n++)if(h(this.pattern.charAt(n-1))&&(0==--r||e===n))return n;return t},i.prototype.attr=function(e,t){return this.element.getAttribute(e)||t},i.prototype.updateValue=function(){this.lastValue=this.currentValue,this.currentValue=this.value,this.currentValue.length===this.lastValue.length+1?this.keyType=this.deny.test(this.elValue.charAt(this.selection-1))?s.INVALID:s.VALID:this.currentValue.length===this.lastValue.length-1?this.keyType=s.BACKSPACE:this.keyType=s.UNKNOWN,console.log(this.keyType)},i.getAutoMask=function(e){return void 0===e.autoMask?e.autoMask=i.byElement(e):(e.autoMask.updateValue(),e.autoMask)},i.byElement=function(e){var t=new i;t.element=e,t.dir=t.attr(a.DIRECTION,u.FORWARD),t.prefix=t.attr(a.PREFIX,""),t.suffix=t.attr(a.SUFFIX,""),t.pattern=t.applyDir(t.attr(a.MASK)),t.showMask="true"===t.attr(a.SHOW_MASK,"").toLowerCase()||!1,t.deny=new RegExp("[^"+t.attr(a.ACCEPT,"\\d")+"]","g"),t.zeroPadEnabled=-1!==t.pattern.indexOf("0"),t.keyType=s.UNKNOWN;for(var r=t.pattern.length,n=t.maxRawLength=0;n<r;n++)h(t.pattern.charAt(n))&&t.maxRawLength++;return e.maxLength=t.pattern.length+t.prefix.length+t.suffix.length+1,t.currentValue=t.value,t},i}()}();